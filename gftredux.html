<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="style.css">
<link rel="stylesheet" type="text/css" href="iThing.css">
</head>
<body>

<div class="grid grid-pad">
   <div class="col-2-3">
     <div class="module">
		<div id="slider"></div>
		<div id="map-canvas"></div>
     </div>
   </div>
   <div class="col-1-3">
     <div class="module">
     	<div id="info"></div>	
     </div>
   </div>
</div>

<script src="jquery-ui-1.10.4.custom/js/jquery-1.10.2.js"></script>
<script src="jquery-ui-1.10.4.custom/js/jquery-ui-1.10.4.custom.js"></script>
<script src="jQDateRangeSlider-min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.2/handlebars.js"></script>
<script src="limabean.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA_Bcq_-jEKafLE0nfdkTNx2Jg7QZDK4Ng&v=3.exp&sensor=false"></script>

<script type="text/javascript">
var map;
var columns = 'mean_temp, geometry, date';
var tableId = '1EpUVocA4uVHzSOzbFrufyeNcVFu6ixxXNQPiH9dF';
	
$(function() {
//initialize jquery ui slider
$("#slider").dateRangeSlider({
    bounds: {min: new Date(2010,0), max: new Date(2014,4)},
    defaultValues: {min: new Date(2010,0), max: new Date(2014,4)},
	step:{months: 1},
	formatter:function(val){
        var days = val.getDate(),
          month = val.getMonth() + 1,
          year = val.getFullYear();
        return month + "/" + year;
      }
	});

//add overlay based on date range	
function getLayer(layer,daterange){
	layer.setOptions({
        query: {
            select: columns,
            from: tableId,
            where: daterange
        },
		styleId: 2
    });
}

$("#slider").bind("valuesChanged", function(e, data){
  console.log("Values just changed. min: " + data.values.min + " max: " + data.values.max);
  //daterange = 'date > \'' + '03/2010' + '\' and date < \'' + '06/2012' + '\'';
  daterange = 'date > \'' + ("0" + (data.values.min.getMonth() + 1)).slice(-2) + '/' + data.values.min.getFullYear() + '\' and date < \'' + ("0" + (data.values.max.getMonth() + 1)).slice(-2) + '/' + data.values.max.getFullYear() + '\'';
  console.log(daterange);
  getLayer(layer,daterange);
});

	var dover = new google.maps.LatLng(39.161944, -75.526667);
	
	map = new google.maps.Map(document.getElementById('map-canvas'), {
		center: dover,
		zoom: 9
	});
	
	var	layer = new google.maps.FusionTablesLayer({
		query: {
		  select: columns,
		  from: tableId,
		  where: 'date > \'03/2011\' and date < \'03/2013\''
		},
		styleId: 2
	  });
	layer.setMap(map);
  
});

</script>


</body>
</html>
